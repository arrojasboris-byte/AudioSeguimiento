<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Seguimiento Audio (Cloud)</title>
  <meta name="theme-color" content="#c82727" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <style>
    :root{
      --rojo:#c82727; --rojo-osc:#a71f1f; --bg:#0b0b0b; --txt:#fff;
      --btnb:#ffffff55; --btnh:#ffffff1a;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--txt);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .wrap{position:fixed;inset:0;display:flex;flex-direction:column;min-height:100%}

    /* Cabecera roja a TODO lo ancho */
    header{
      width:100%;
      background:linear-gradient(180deg,var(--rojo),var(--rojo-osc));
      color:#fff; padding:10px 12px;
      display:flex; align-items:center; gap:10px;
      box-shadow:0 4px 16px rgba(0,0,0,.15);
      z-index:2
    }
    .brand{display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:.2px}
    .brand .badge{background:#fff;color:#7b0e0e;border-radius:999px;padding:4px 10px;font-weight:900}
    .spacer{flex:1}
    header button, header a{
      color:#fff; text-decoration:none; border:1px solid var(--btnb); background:transparent;
      padding:6px 10px; border-radius:10px; font-weight:700; cursor:pointer; font-size:12px
    }
    header button:hover, header a:hover{ background:var(--btnh) }

    /* √Årea app */
    .stage{flex:1; min-height:0; display:flex; flex-direction:column}
    iframe{flex:1; border:0; width:100%; height:100%; background:#111}

    /* Fallback */
    .fallback{padding:8px 12px; background:#111; color:#fff; font-size:12px}
    .fallback a{color:#9cd3ff}

    /* Avisos */
    .notice{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:14px; background:#111; color:#fff; border:1px solid #333;
      padding:8px 10px; border-radius:10px; font-size:12px; box-shadow:0 6px 14px rgba(0,0,0,.25);
      opacity:.97; z-index:3; display:none;
    }

    /* Responsive */
    @media (max-width:480px){
      header{gap:6px; padding:8px}
      .brand span{display:none} /* deja solo üéß + AROJAS en m√≥vil */
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <span aria-hidden="true">üéß</span>
        <span>Seguimiento Audio ‚Äî Cloud</span>
        <span class="badge" title="Identidad">AROjas</span>
      </div>
      <div class="spacer"></div>
      <button id="reloadBtn" title="Recargar la app en el iframe">Recargar</button>
      <a id="openBtn" target="_blank" rel="noopener" title="Abrir en pesta√±a nueva">Abrir ‚Üó</a>
      <button id="copyBtn" title="Copiar enlace de la app">Copiar enlace</button>
    </header>

    <div class="stage">
      <!-- La WebApp de Apps Script se carga aqu√≠ -->
      <iframe id="app" title="Seguimiento Audio Cloud" loading="lazy" allowfullscreen></iframe>

      <div class="fallback">
        Si no carga dentro de esta p√°gina, abre directamente la WebApp:
        <a id="directLink" href="#" target="_blank" rel="noopener">Abrir WebApp</a>
        <div style="opacity:.7;margin-top:6px">
          Si sigue en blanco, verifica en tu Apps Script:
          <code>doGet(...).setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL)</code>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="notice" role="status" aria-live="polite"></div>

  <script>
    // üëâ TU URL /exec de Apps Script (nube)
    const APP_URL = 'https://script.google.com/macros/s/AKfycbxtY7kFp_uX3OFw3c47MrtRng88686psCzbCH__6mGFh1m5B7v08DSFimKtbcoA9PGF/exec';

    const $ = (s)=>document.querySelector(s);
    const toast = (msg)=>{
      const t = $('#toast');
      t.textContent = msg;
      t.style.display = 'block';
      clearTimeout(window.__tHide);
      window.__tHide = setTimeout(()=>{ t.style.display='none'; }, 1400);
    };

    function setSrc(force=false){
      // cache-busting para asegurar que siempre ves la √∫ltima actualizaci√≥n
      const url = APP_URL + (APP_URL.includes('?') ? '&' : '?') + 't=' + Date.now();
      const frame = $('#app');
      if(force || frame.src !== url){ frame.src = url; }
    }

    document.addEventListener('DOMContentLoaded', ()=>{
      // Enlaces √∫tiles
      $('#openBtn').href = APP_URL;
      $('#directLink').href = APP_URL;

      // Acciones
      $('#reloadBtn').addEventListener('click', ()=>{ setSrc(true); toast('Recargando‚Ä¶'); });
      $('#copyBtn').addEventListener('click', async ()=>{
        try{
          await navigator.clipboard.writeText(APP_URL);
          toast('Enlace copiado');
        }catch(e){
          // Fallback
          const a = document.createElement('a'); a.href = APP_URL; a.target = '_blank'; a.rel = 'noopener';
          toast('No se pudo copiar. Abriendo nueva pesta√±a‚Ä¶'); a.click();
        }
      });

      // Cargar app
      setSrc(true);
    });
  </script>
</body>
</html>
